(()=>{"use strict";var t={912:(t,i,e)=>{e.d(i,{Z:()=>g});var s=e(537),n=e.n(s),o=e(645),a=e.n(o),h=e(667),r=e.n(h),c=new URL(e(225),e.b),l=a()(n()),_=r()(c);l.push([t.id,"@font-face{font-family:'Nunito';src:url("+_+") format('woff2');font-weight:900;font-style:#000}body{position:fixed;top:0;left:0;display:flex;justify-content:center;width:100%;height:100%;margin:0;padding:0;overflow:hidden;background-color:#0f335a}","",{version:3,sources:["webpack://./src/assets/styles/index.styl"],names:[],mappings:"AAAA,WACE,oBAAY,CACZ,2DAAqC,CACrC,eAAY,CACZ,eAAW,CAEb,KACE,cAAS,CACT,KAAI,CACJ,MAAK,CACL,YAAQ,CACR,sBAAgB,CAChB,UAAM,CACN,WAAO,CACP,QAAO,CACP,SAAQ,CACR,eAAS,CACT,wBAAiB",sourcesContent:["@font-face\r\n  font-family 'Nunito'\r\n  src url('../fonts/Nunito-Black.woff2') format('woff2')\r\n  font-weight 900\r\n  font-style black\r\n\r\nbody\r\n  position fixed\r\n  top 0\r\n  left 0\r\n  display flex\r\n  justify-content center\r\n  width 100%\r\n  height 100%\r\n  margin 0\r\n  padding 0\r\n  overflow hidden\r\n  background-color #0F335A\r\n\t\t\t"],sourceRoot:""}]);const g=l},645:t=>{t.exports=function(t){var i=[];return i.toString=function(){return this.map((function(i){var e="",s=void 0!==i[5];return i[4]&&(e+="@supports (".concat(i[4],") {")),i[2]&&(e+="@media ".concat(i[2]," {")),s&&(e+="@layer".concat(i[5].length>0?" ".concat(i[5]):""," {")),e+=t(i),s&&(e+="}"),i[2]&&(e+="}"),i[4]&&(e+="}"),e})).join("")},i.i=function(t,e,s,n,o){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(s)for(var h=0;h<this.length;h++){var r=this[h][0];null!=r&&(a[r]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);s&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),e&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=e):l[2]=e),n&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=n):l[4]="".concat(n)),i.push(l))}},i}},667:t=>{t.exports=function(t,i){return i||(i={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),i.hash&&(t+=i.hash),/["'() \t\n]|(%20)/.test(t)||i.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},537:t=>{t.exports=function(t){var i=t[1],e=t[3];if(!e)return i;if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),o="/*# ".concat(n," */");return[i].concat([o]).join("\n")}return[i].join("\n")}},379:t=>{var i=[];function e(t){for(var e=-1,s=0;s<i.length;s++)if(i[s].identifier===t){e=s;break}return e}function s(t,s){for(var o={},a=[],h=0;h<t.length;h++){var r=t[h],c=s.base?r[0]+s.base:r[0],l=o[c]||0,_="".concat(c," ").concat(l);o[c]=l+1;var g=e(_),d={css:r[1],media:r[2],sourceMap:r[3],supports:r[4],layer:r[5]};if(-1!==g)i[g].references++,i[g].updater(d);else{var u=n(d,s);s.byIndex=h,i.splice(h,0,{identifier:_,updater:u,references:1})}a.push(_)}return a}function n(t,i){var e=i.domAPI(i);return e.update(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap&&i.supports===t.supports&&i.layer===t.layer)return;e.update(t=i)}else e.remove()}}t.exports=function(t,n){var o=s(t=t||[],n=n||{});return function(t){t=t||[];for(var a=0;a<o.length;a++){var h=e(o[a]);i[h].references--}for(var r=s(t,n),c=0;c<o.length;c++){var l=e(o[c]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}o=r}}},569:t=>{var i={};t.exports=function(t,e){var s=function(t){if(void 0===i[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}i[t]=e}return i[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}},216:t=>{t.exports=function(t){var i=document.createElement("style");return t.setAttributes(i,t.attributes),t.insert(i,t.options),i}},565:(t,i,e)=>{t.exports=function(t){var i=e.nc;i&&t.setAttribute("nonce",i)}},37:t=>{var i,e=(i=[],function(t,e){return i[t]=e,i.filter(Boolean).join("\n")});function s(t,i,s,n){var o;if(s)o="";else{o="",n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,a&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}")}if(t.styleSheet)t.styleSheet.cssText=e(i,o);else{var h=document.createTextNode(o),r=t.childNodes;r[i]&&t.removeChild(r[i]),r.length?t.insertBefore(h,r[i]):t.appendChild(h)}}var n={singleton:null,singletonCounter:0};t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var i=n.singletonCounter++,e=n.singleton||(n.singleton=t.insertStyleElement(t));return{update:function(t){s(e,i,!1,t)},remove:function(t){s(e,i,!0,t)}}}},225:(t,i,e)=>{t.exports=e.p+"fonts/Nunito-Black.woff2"},170:(t,i,e)=>{t.exports=e.p+"images/star-blue-af7903449c2ce244dcae.png"},397:(t,i,e)=>{t.exports=e.p+"images/star-green-f0d2691d1a94d1af287b.png"},933:(t,i,e)=>{t.exports=e.p+"images/star-yellow-4ad40b40a60494284ced.png"}},i={};function e(s){var n=i[s];if(void 0!==n)return n.exports;var o=i[s]={id:s,exports:{}};return t[s](o,o.exports,e),o.exports}e.m=t,e.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},e.d=(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),e.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var i=e.g.document;if(!t&&i&&(i.currentScript&&(t=i.currentScript.src),!t)){var s=i.getElementsByTagName("script");s.length&&(t=s[s.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.b=document.baseURI||self.location.href,e.nc=void 0,(()=>{var t=e(379),i=e.n(t),s=e(37),n=e.n(s),o=e(569),a=e.n(o),h=e(565),r=e.n(h),c=e(216),l=e.n(c),_=e(912),g={};g.setAttributes=r(),g.insert=a().bind(null,"head"),g.domAPI=n(),g.insertStyleElement=l(),i()(_.Z,g),_.Z&&_.Z.locals&&_.Z.locals;class d{constructor(){this._assets={},this._loaded=0}load(){return new Promise((t=>{d.data.length||t(),d.data.forEach((i=>{const e=i.fileName.split(".").pop();d.imagesTypes.includes(e)&&this._loadImage(i,t)}))}))}_increaseLoaded(t){this._loaded+=1,this._loaded===d.data.length&&t()}_loadImage(t,i){const e=new Image;e.addEventListener("load",(()=>{this._assets[t.fileName]=e,this._increaseLoaded(i)})),e.src=t.file}get(t){return this._assets[t]}static imagesTypes=["png"];static data=[{fileName:"star-yellow.png",file:e(933)},{fileName:"star-blue.png",file:e(170)},{fileName:"star-green.png",file:e(397)}]}class u{constructor({levels:t}){this._levels=t}getLevelsList(){return Object.keys(levels).reduce(((t,i)=>t.concat(this._levels[i])),[])}getLevelById(t){t=+t;for(let i in this._levels){const e=this._levels[i].find((i=>i.id===t));if(e)return e}}getLevelByKeyAndIndex(t,i){return this._levels[t][i]}getLevelsByKey(t){return this._levels[t]}getLevelScore(t,i){const e=this.getLevelById(i);return t<=e.moves?u.maxScore:t<=2*e.moves?u.maxScore-1:u.minScore}static maxScore=3;static minScore=1}class p{static ysdk=null;static player=null;static async initYSDK(){return YaGames.init().then((t=>{p.ysdk=t,t.features.LoadingAPI?.ready(),console.log("Yandex SDK initialized")})).catch((t=>{console.log("Ошибка при инициализации YSDK")}))}static async initPlayer(){return p.ysdk.getPlayer({scopes:!1}).then((t=>{p.player=t,console.log("Player initialized")})).catch((t=>{console.log("Ошибка при инициализации объекта Player")}))}static async savePlayerStats(t){return p.player.setStats(t).then((()=>{console.log("Player data is saved")})).catch((t=>{console.log("Ошибка при сохранении данных игрока")}))}static async getPlayerStats(){return p.player.getStats().then((t=>(console.log("Получены сохраненные данные игрока"),t))).catch((t=>{console.log("Ошибка при получении данных игрока")}))}}class v{constructor({levels:t}){this._levels=t,this._levelsScores={},this._levelsMoves={}}async resetPlayerStats(){this._levelsMoves={},this._levelsScores={}}async loadPlayerStats(){const t=await p.getPlayerStats();if(t){this._levelsMoves=t;for(let i in t)this._levelsScores[i]=this._levels.getLevelScore(t[i],i)}}getRating(){return Object.values(this._levelsScores).reduce(((t,i)=>t+i),0)}async setLevelResult(t,i,e){const s=this._levelsMoves[t];(!s||s>i)&&(this._levelsScores[t]=e,this._levelsMoves[t]=i)}getLevelPrevScore(t){return this._levelsScores[t]}getLevelPrevMoves(t){return this._levelsMoves[t]}}class m{static rect(t,i,e,s,n,o,a=1){t.globalAlpha=a,t.fillStyle=o,t.fillRect(i,e,s,n),t.globalAlpha=1}static roundedRect(t,i,e,s,n,o,a,h=1){t.globalAlpha=h,t.fillStyle=a,t.beginPath(),t.moveTo(i,e+o),t.arcTo(i,e+n,i+o,e+n,o),t.arcTo(i+s,e+n,i+s,e+n-o,o),t.arcTo(i+s,e,i+s-o,e,o),t.arcTo(i,e,i,e+o,o),t.fill(),t.globalAlpha=1}static stroke(t,i,e){t.strokeStyle=e,t.lineWidth=i,t.stroke()}static text(t,i,e,s,n,o,a=1){t.globalAlpha=a,t.fillStyle=o,t.font=`${n}px Nunito`,t.fillText(s,i,e),t.globalAlpha=1}static image(t,i,e,s,n,o,a=1){t.globalAlpha=a,t.drawImage(o,i,e,s,n),t.globalAlpha=1}static slicedImage(t,i,e,s,n,o,a,h,r,c,l=1){t.globalAlpha=l,t.drawImage(c,i,e,s,n,o,a,h,r),t.globalAlpha=1}}class x{static blueDeep={id:2,key:"#0F335A"};static blueNight={id:3,key:"#143D6C"};static blue={id:4,key:"#4A5AEC"};static green={id:5,key:"#73AE37"};static sea={id:6,key:"#4BD5F5"};static red={id:7,key:"#D74E23"};static purple={id:8,key:"#E436EE"};static orange={id:9,key:"#FF891C"};static yellow={id:10,key:"#FFC530"};static white={id:11,key:"#FFFFFF"}}class y{static calcTextMetrics(t,i,e){t.font=`${e}px Nunito`;const{width:s,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o}=t.measureText(i);return{textWidth:s,textHeight:n+o}}static calcMultistringTextMetrics(t,i,e,s){return i.map(((n,o)=>{const a=i.slice(0,o),h=a.reduce(((t,i)=>t+i.length*s),0)+a.length*s;return n.map(((i,n)=>{const{textWidth:o}=y.calcTextMetrics(t,i,e);return{string:i,width:o,positionY:h+n*s+e}}))})).flat()}}class f{constructor({ctx:t,position:i,size:e,label:s}){this._ctx=t,this._position=i,this._size=e,this._label=s,this._labelPosition={x:0,y:0},this._setLabelPosition()}render(){m.roundedRect(this._ctx,this._position.x,this._position.y,this._size.width,this._size.height,f.radius,x.blueNight.key),m.text(this._ctx,this._labelPosition.x,this._labelPosition.y,this._label,f.fontSize,x.white.key)}isPressed(t){return t.x>this._position.x&&t.x<this._position.x+this._size.width&&t.y>this._position.y&&t.y<this._position.y+this._size.height}_setLabelPosition(){const{textWidth:t}=y.calcTextMetrics(this._ctx,this._label,f.fontSize);this._labelPosition.x=this._position.x+this._size.width/2-t/2,this._labelPosition.y=this._position.y+this._size.height/2+f.fontSize/3}static height=74;static fontSize=32;static radius=37}class M{constructor({ctx:t,state:i,assets:e}){this._ctx=t,this._state=i,this._assets=e,this._icon=this._assets.get("star-yellow.png"),this._rating=this._state.getRating(),this._ratingPosition={x:0,y:0},this._setRatingPosition()}render(){m.image(this._ctx,M.iconPositionX,M.iconPositionY,M.iconWidth,M.iconHeight,this._icon),m.text(this._ctx,this._ratingPosition.x,this._ratingPosition.y,this._rating,M.ratingFontSize,x.white.key)}_setRatingPosition(){const{textWidth:t}=y.calcTextMetrics(this._ctx,this._rating,M.ratingFontSize);this._ratingPosition.x=M.iconPositionX-M.ratingMarginRight-t,this._ratingPosition.y=M.ratingPositionY+M.ratingFontSize}static iconPositionX=651;static iconPositionY=23;static iconWidth=30;static iconHeight=29;static ratingPositionY=19;static ratingMarginRight=15;static ratingFontSize=32}class P{constructor({ctx:t,assets:i,position:e,size:s,unlockRating:n,label:o}){this._ctx=t,this._assets=i,this._position=e,this._size=s,this._label=o,this._labelPosition={x:0,y:0},this._setLabelPosition(),this._icon=this._assets.get("star-yellow.png"),this._iconPosition={x:0,y:0},this._setIconPosition(),this._unlockRatingLabel=n,this._unlockRatingLabelPosition={x:0,y:0},this._setUnlockRatingLabelPosition()}render(){m.roundedRect(this._ctx,this._position.x,this._position.y,this._size.width,this._size.height,P.radius,x.blueNight.key,P.opacity),m.text(this._ctx,this._labelPosition.x,this._labelPosition.y,this._label,P.fontSize,x.white.key,P.opacity),m.image(this._ctx,this._iconPosition.x,this._iconPosition.y,P.iconWidth,P.iconHeight,this._icon,P.opacity),m.text(this._ctx,this._unlockRatingLabelPosition.x,this._unlockRatingLabelPosition.y,this._unlockRatingLabel,P.fontSize,x.white.key,P.opacity)}isPressed(){}_setLabelPosition(){this._labelPosition.x=this._position.x+P.paddingHorizontal,this._labelPosition.y=this._position.y+this._size.height/2+P.fontSize/3}_setIconPosition(){const{textWidth:t}=y.calcTextMetrics(this._ctx,this._label,P.fontSize);this._iconPosition.x=this._labelPosition.x+t+P.iconHorizontalMargin,this._iconPosition.y=this._position.y+this._size.height/2-P.iconHeight/2}_setUnlockRatingLabelPosition(){this._unlockRatingLabelPosition.x=this._iconPosition.x+P.iconWidth+P.iconHorizontalMargin,this._unlockRatingLabelPosition.y=this._position.y+this._size.height/2+P.fontSize/3}static height=74;static paddingHorizontal=40;static fontSize=32;static radius=37;static opacity=.25;static iconWidth=30;static iconHeight=29;static iconHorizontalMargin=15}class b{constructor({canvas:t,ctx:i,assets:e,state:s,sceneManager:n}){this._canvas=t,this._ctx=i,this._assets=e,this._state=s,this._sceneManager=n,this._ratingPreview=new M({ctx:this._ctx,state:this._state,assets:this._assets}),this._titleMarkup=[],this._setTitleMarkup(),this._beginnerButton=null,this._mediumButton=null,this._hardButton=null,this._aboutButton=null,this._initButtons()}update(t){}render(){m.rect(this._ctx,0,0,this._canvas.width,this._canvas.height,x.blueDeep.key),this._ratingPreview.render(),this._titleMarkup.forEach((({string:t,position:i})=>{m.text(this._ctx,i.x,i.y,t,b.titleFontSize,x.white.key)})),this._beginnerButton.render(),this._mediumButton.render(),this._hardButton.render(),this._aboutButton.render()}handleClick({position:t}){this._beginnerButton.isPressed(t)?this._sceneManager.showLevelsScene("beginner"):this._mediumButton.isPressed(t)?this._sceneManager.showLevelsScene("medium"):this._hardButton.isPressed(t)?this._sceneManager.showLevelsScene("hard"):this._aboutButton.isPressed(t)&&this._sceneManager.showAboutScene()}handleStartDragging(){}handleDragging(){}handleEndDragging(){}_setTitleMarkup(){const t=[b.title.split("<br>")],i=y.calcMultistringTextMetrics(this._ctx,t,b.titleFontSize,b.titleLineHeight);this._titleMarkup=i.map((t=>{const{string:i,positionY:e,width:s}=t;return{string:i,position:{x:this._canvas.width/2-s/2,y:b.titlePositionY+e}}}))}_initButtons(){this._beginnerButton=new f({ctx:this._ctx,position:{x:b.beginnerButtonPositionX,y:b.beginnerButtonPositionY},size:{width:b.beginnerButtonWidth,height:f.height},label:b.beginnerButtonLabel});const t=this._state.getRating(),i=t>=b.mediumUnlockRating,e=i?f:P;this._mediumButton=new e({ctx:this._ctx,assets:this._assets,position:{x:i?b.mediumButtonPositionX:b.mediumLockedButtonPositionX,y:b.mediumButtonPositionY},size:{width:i?b.mediumButtonWidth:b.mediumLockedButtonWidth,height:e.height},unlockRating:b.mediumUnlockRating,label:b.mediumButtonLabel});const s=t>=b.hardUnlockRating,n=s?f:P;this._hardButton=new n({ctx:this._ctx,assets:this._assets,position:{x:s?b.hardButtonPositionX:b.hardLockedButtonPositionX,y:b.hardButtonPositionY},size:{width:s?b.hardButtonWidth:b.hardLockedButtonWidth,height:n.height},unlockRating:b.hardUnlockRating,label:b.hardButtonLabel}),this._aboutButton=new f({ctx:this._ctx,position:{x:b.aboutButtonPositionX,y:b.aboutButtonPositionY},size:{width:b.aboutButtonWidth,height:f.height},label:b.aboutButtonLabel})}static title="Rows<br>and<br>Columns";static titleFontSize=96;static titleLineHeight=100;static titlePositionY=240;static beginnerButtonLabel="Начинающий";static beginnerButtonWidth=300;static beginnerButtonPositionX=200;static beginnerButtonPositionY=620;static mediumUnlockRating=24;static mediumButtonLabel="Средний";static mediumButtonWidth=222;static mediumLockedButtonWidth=321;static mediumButtonPositionX=239;static mediumButtonPositionY=724;static mediumLockedButtonPositionX=190;static hardUnlockRating=52;static hardButtonLabel="Сложный";static hardButtonWidth=237;static hardLockedButtonWidth=336;static hardButtonPositionX=232;static hardButtonPositionY=828;static hardLockedButtonPositionX=182;static aboutButtonLabel="Об игре";static aboutButtonWidth=210;static aboutButtonPositionX=245;static aboutButtonPositionY=932}class w{constructor({canvas:t,ctx:i,sceneManager:e}){this._canvas=t,this._ctx=i,this._sceneManager=e,this._backButton=null,this._initButton(),this._titlePosition={x:0,y:0},this._setTitlePosition(),this._descriptionMarkup=[],this._setDescriptionMarkup()}update(t){}render(){m.rect(this._ctx,0,0,this._canvas.width,this._canvas.height,x.blueDeep.key),this._backButton.render(),m.text(this._ctx,this._titlePosition.x,this._titlePosition.y,w.title,w.titleFontSize,x.white.key),this._descriptionMarkup.forEach((({string:t,position:i})=>{m.text(this._ctx,i.x,i.y,t,w.descriptionFontSize,x.white.key)}))}_setTitlePosition(){const{textWidth:t}=y.calcTextMetrics(this._ctx,w.title,w.titleFontSize);this._titlePosition.x=this._canvas.width/2-t/2,this._titlePosition.y=w.titlePositionY+w.titleFontSize}_setDescriptionMarkup(){const t=w.description.map((t=>t.split("<br>"))),i=y.calcMultistringTextMetrics(this._ctx,t,w.descriptionFontSize,w.descriptionLineHeight);this._descriptionMarkup=i.map((t=>{const{string:i,positionY:e,width:s}=t;return{string:i,position:{x:this._canvas.width/2-s/2,y:w.descriptionPositionY+e}}}))}handleClick({position:t}){this._backButton.isPressed(t)&&this._sceneManager.showOpenScene()}handleStartDragging(){}handleDragging(){}handleEndDragging(){}_initButton(){this._backButton=new f({ctx:this._ctx,position:{x:w.backButtonPositionX,y:w.backButtonPositionY},size:{width:w.backButtonWidth,height:f.height},label:w.backButtonLabel})}static title="Об игре";static titleFontSize=72;static titlePositionY=294;static description=["Цель игры – собирать<br>композиции из цветных плиток.<br>Перемещайте ряды влево и<br>вправо, а колонки вниз и вверх.<br>Если какая-то плитка при<br>смещении выйдет за границу<br>игрового поля, она появится<br>с противоположного края.<br>Приятной игры.","Связь с автором:<br>mb.games@yandex.ru"];static descriptionFontSize=32;static descriptionLineHeight=42;static descriptionPositionY=450;static backButtonLabel="Назад";static backButtonPositionX=19;static backButtonPositionY=19;static backButtonWidth=181}class S{constructor({ctx:t,assets:i,position:e,level:s,prevScore:n,prevMoves:o}){this._ctx=t,this._assets=i,this._position=e,this._level=s,this._levelLabel=this._level.getIndex()+1,this._levelLabelPosition={x:0,y:0},this._setLevelLabelPosition(),this._prevMoves=o,this._prevMovesPosition={x:0,y:0},this._setPrevMovesPosition(),this._prevScore=n,this._prevScoreMarkup=[],this._setPrevScoreMarkup(),this._color=this._prevScore?x.green:x.blueNight}render(){m.roundedRect(this._ctx,this._position.x,this._position.y,S.width,S.height,S.radius,this._color.key),m.text(this._ctx,this._levelLabelPosition.x,this._levelLabelPosition.y,this._levelLabel,S.levelLabelFontSize,x.white.key),0!==this._prevMoves&&m.text(this._ctx,this._prevMovesPosition.x,this._prevMovesPosition.y,this._prevMoves,S.prevMovesFontSize,x.white.key),0!==this._prevScore&&this._prevScoreMarkup.forEach((({icon:t,position:i})=>{m.image(this._ctx,i.x,i.y,S.iconWidth,S.iconHeight,t)}))}isPressed(t){return t.x>this._position.x&&t.x<this._position.x+S.width&&t.y>this._position.y&&t.y<this._position.y+S.height}_setPrevScoreMarkup(){const t=[];for(let i=0;i<u.maxScore;i++)t.push({icon:i<this._prevScore?this._assets.get("star-yellow.png"):this._assets.get("star-green.png"),position:{x:this._position.x+S.padding+i*(S.iconWidth+S.iconGap),y:this._position.y+S.height-S.padding-S.iconHeight}});this._prevScoreMarkup=t}_setPrevMovesPosition(){this._prevMovesPosition.x=this._position.x+S.padding,this._prevMovesPosition.y=this._position.y+S.height-S.padding-S.iconHeight-S.prevMovesMarginBottom-S.prevMovesLineHeight+S.prevMovesFontSize}_setLevelLabelPosition(){this._levelLabelPosition.x=this._position.x+S.padding,this._levelLabelPosition.y=this._position.y+S.padding+S.levelLabelFontSize-S.levelLabelLineHeight/4}getLevel(){return this._level}static width=180;static height=180;static radius=46;static padding=24;static levelLabelFontSize=48;static levelLabelLineHeight=52;static prevMovesFontSize=32;static prevMovesLineHeight=36;static prevMovesMarginBottom=4;static iconWidth=30;static iconHeight=29;static iconGap=6}class B{constructor({ctx:t,color:i,size:e,position:s}){this._ctx=t,this._color=i,this._size=e,this._position=s,this._opacity=1,this._scaleFactor=1}render(){const t=this._size.width*this._scaleFactor,i=this._size.height*this._scaleFactor,e=this._position.x-(t-this._size.width)/2,s=this._position.y-(i-this._size.height)/2,n=B.radius*this._scaleFactor;m.roundedRect(this._ctx,e,s,t,i,n,this._color.key,this._opacity)}getScaleFactor(){return this._scaleFactor}setScaleFactor(t){this._scaleFactor=t}getPosition(){return this._position}setPosition(t){this._position=t}getColor(){return this._color}getOpacity(){return this._opacity}setOpacity(t){this._opacity=t}static radius=30;static colors=[x.blueNight,x.blue,x.green,x.sea,x.red,x.purple,x.orange,x.yellow]}class k{constructor({key:t,index:i,id:e,targetMap:s,initialMap:n,moves:o}){this._key=t,this._index=i,this._id=e,this._targetMap=s,this._initialMap=n,this._moves=o}match(t){return t.every(((t,i)=>t.every(((t,e)=>t.getTile().getColor().id===this._targetMap[i][e]))))}getKey(){return this._key}getIndex(){return this._index}getId(){return this._id}getTargetMap(){return this._targetMap}getMapLengths(){return{x:this._targetMap[0].length,y:this._targetMap.length}}getColors(){return this._initialMap.flat().map((t=>B.colors.find((i=>i.id===t))))}}class L{constructor({canvas:t,ctx:i,assets:e,state:s,sceneManager:n,levels:o,levelsKey:a}){this._canvas=t,this._ctx=i,this._assets=e,this._state=s,this._sceneManager=n,this._levels=o,this._levelsKey=a,this._backButton=null,this._initButton(),this._titleMarkup=[],this._setTitleMarkup(),this._levelsButtons=[],this._setLevelsButtons()}update(t){}render(){m.rect(this._ctx,0,0,this._canvas.width,this._canvas.height,x.blueDeep.key),this._backButton.render(),this._titleMarkup.forEach((({string:t,position:i})=>{m.text(this._ctx,i.x,i.y,t,L.titleFontSize,x.white.key)})),this._levelsButtons.forEach((t=>{t.render()}))}handleClick({position:t}){this._backButton.isPressed(t)&&this._sceneManager.showOpenScene(),this._levelsButtons.forEach((i=>{if(i.isPressed(t)){const t=i.getLevel();this._sceneManager.showCoreScene(t)}}))}handleStartDragging(){}handleDragging(){}handleEndDragging(){}_setTitleMarkup(){const t=[L.title.split("<br>")],i=y.calcMultistringTextMetrics(this._ctx,t,L.titleFontSize,L.titleLineHeight);this._titleMarkup=i.map((t=>{const{string:i,positionY:e,width:s}=t;return{string:i,position:{x:this._canvas.width/2-s/2,y:L.titlePositionY+e}}}))}_setLevelsButtons(){this._levels.getLevelsByKey(this._levelsKey).forEach((({id:t,targetMap:i,initialMap:e,moves:s},n)=>{const o=n%3,a=Math.floor(n/3),h=new S({ctx:this._ctx,assets:this._assets,position:{x:L.gridPositionX+o*(S.width+L.gridGap),y:L.gridPositionY+a*(S.height+L.gridGap)},level:new k({key:this._levelsKey,index:n,id:t,targetMap:i,initialMap:e,moves:s}),prevScore:this._state.getLevelPrevScore(t)||0,prevMoves:this._state.getLevelPrevMoves(t)||0});this._levelsButtons.push(h)}))}_initButton(){this._backButton=new f({ctx:this._ctx,position:{x:L.backButtonPositionX,y:L.backButtonPositionY},size:{width:L.backButtonWidth,height:f.height},label:L.backButtonLabel})}static title="Выберите<br>уровень";static titlePositionY=153;static titleFontSize=72;static titleLineHeight=76;static gridWidth=600;static gridGap=30;static gridPositionX=50;static gridPositionY=385;static backButtonLabel="Назад";static backButtonPositionY=19;static backButtonPositionX=19;static backButtonWidth=181}class C{constructor({ctx:t,map:i}){this._ctx=t,this._map=i,this._columnWidth=0,this._rowHeight=0,this._setMetrics()}render(){this._map.forEach(((t,i)=>{t.forEach(((t,e)=>{const s=C.positionX+(this._columnWidth+C.gap)*e,n=C.positionY+(this._rowHeight+C.gap)*i,o=B.colors.find((i=>i.id===t));m.roundedRect(this._ctx,s,n,this._columnWidth,this._rowHeight,C.tileRadius,o.key)}))}))}_setMetrics(){const t=this._map[0].length,i=this._map.length;this._columnWidth=(C.width-C.gap*(t-1))/t,this._rowHeight=(C.height-C.gap*(i-1))/i}static width=194;static height=194;static positionX=487;static positionY=19;static gap=2;static tileRadius=10}class T{constructor({coords:t}){this._coords=t,this._tile=null,this._detachedTile=null}render(){this._tile&&this._tile.render()}setTile(t){this._tile=t;const i=this._detachedTile;return this._detachedTile=null,this._tile!==i}getTile(){return this._tile}detachTile(){const t=this._tile;return this._detachedTile=t,this._tile=null,t}getCoords(){return this._coords}}class D{constructor({tile:t,delay:i=0}){this._tile=t,this._delay=i,this._startTime=null,this._finished=!1}update({timestamp:t}){if(this._finished)return;null===this._startTime&&(this._startTime=t+this._delay);const i=t-this._startTime;if(i<0)return;let e=1;if(i<D.duration){const t=i/D.duration;e=Math.pow(1-t,2)*D.path[0]+2*(1-t)*t*D.path[1]+Math.pow(t,2)*D.path[2]}else this._finished=!0;this._tile.setScaleFactor(e)}isFinished(){return this._finished}static duration=1e3;static path=[1,.6,1]}class A{constructor({ctx:t,assets:i,state:e,levels:s,sceneManager:n,level:o}){this._ctx=t,this._assets=i,this._state=e,this._levels=s,this._sceneManager=n,this._level=o,this._columnWidth=0,this._rowHeight=0,this._maxOutOfBoundsX=0,this._maxOutOfBoundsY=0,this._setMetrics(),this._map=[],this._setMap(),this._setTiles(),this._animations=[],this._startDraggingPosition=null,this._startDraggingCoords=null,this._prevDraggingPosition=null,this._draggingAxis=null,this._detachedTiles=[],this._levelComplete=!1,this._moves=0}update(t){this._animations.forEach((i=>i.update(t))),this._animations=this._animations.filter((t=>!t.isFinished()))}render(){this._map.forEach((t=>{t.forEach((t=>t.render()))})),this._detachedTiles.forEach((t=>t.render()))}handleStartDragging({position:t}){!this._levelComplete&&this._isFieldIncludesPosition(t)&&(this._startDraggingPosition=t,this._startDraggingCoords=this.getCoordsByPosition(t),this._prevDraggingPosition=t)}handleDragging({position:t}){this._startDraggingPosition&&this._startDraggingCoords&&(this._draggingAxis||this._setDraggingAxis(t),this._detachedTiles.length||this._detachTiles(),"x"===this._draggingAxis?this._moveRow(t):this._moveColumn(t),this._prevDraggingPosition=t)}_setDraggingAxis(t){const i=this._startDraggingPosition.x-t.x,e=this._startDraggingPosition.y-t.y;this._draggingAxis=Math.abs(i)>Math.abs(e)?"x":"y"}handleEndDragging(t){if(!this._detachedTiles.length)return;const i=this._draggingAxis;this._detachedTiles.sort(((t,e)=>t.getPosition()[i]-e.getPosition()[i]));let e=!1;"x"===i?this._map[this._startDraggingCoords.y].forEach((t=>{const i=this._attachFirstDetachedTileToCell(t);e=e||i})):this._map.forEach((t=>{const i=t[this._startDraggingCoords.x],s=this._attachFirstDetachedTileToCell(i);e=e||s})),e&&(this._moves+=1),this._startDraggingPosition=null,this._startDraggingCoords=null,this._prevDraggingPosition=null,this._draggingAxis=null,this._handleDraggingResult()}_attachFirstDetachedTileToCell(t){const i=t.getCoords(),e=this._detachedTiles.shift(),s=this.getPositionByCoords(i);return e.setPosition(s),e.setOpacity(1),t.setTile(e)}async _handleDraggingResult(){if(this._levelComplete=this._level.match(this._map),!this._levelComplete)return;this._startLevelCompliteAnimation();const t=this._levels.getLevelScore(this._moves,this._level.getId());await this._state.setLevelResult(this._level.getId(),this._moves,t),setTimeout((()=>{this._sceneManager.showResultScene(this._moves,t,this._level)}),1500)}_startLevelCompliteAnimation(){this._map.forEach((t=>{t.forEach((t=>{const i=t.getTile(),e=new D({tile:i});this._animations.push(e)}))}))}_detachTiles(){this._detachedTiles="x"===this._draggingAxis?this._map[this._startDraggingCoords.y].map((t=>t.detachTile())):this._map.map((t=>t[this._startDraggingCoords.x].detachTile()))}_moveRow(t){const i=t.x-this._prevDraggingPosition.x;this._detachedTiles.forEach((t=>{const e=t.getPosition(),s={x:e.x+i,y:e.y};i<0&&s.x<A.positionX-this._maxOutOfBoundsX?s.x+=this._detachedTiles.length*(this._columnWidth+A.gap):i>0&&s.x+this._columnWidth>A.positionX+A.width+this._maxOutOfBoundsX&&(s.x-=this._detachedTiles.length*(this._columnWidth+A.gap));let n=1;s.x<A.positionX?n=1-(A.positionX-s.x)/this._maxOutOfBoundsX:s.x+this._columnWidth>A.positionX+A.width&&(n=1-(s.x+this._columnWidth-(A.positionX+A.width))/this._maxOutOfBoundsX),t.setOpacity(n),t.setPosition(s)}))}_moveColumn(t){const i=t.y-this._prevDraggingPosition.y;this._detachedTiles.forEach((t=>{const e=t.getPosition(),s={x:e.x,y:e.y+i};i<0&&s.y<A.positionY-this._maxOutOfBoundsY?s.y+=this._detachedTiles.length*(this._rowHeight+A.gap):i>0&&s.y+this._rowHeight>A.positionY+A.height+this._maxOutOfBoundsY&&(s.y-=this._detachedTiles.length*(this._rowHeight+A.gap));let n=1;s.y<A.positionY?n=1-(A.positionY-s.y)/this._maxOutOfBoundsY:s.y+this._rowHeight>A.positionY+A.height&&(n=1-(s.y+this._rowHeight-(A.positionY+A.height))/this._maxOutOfBoundsY),t.setOpacity(n),t.setPosition(s)}))}getCoordsByPosition(t){return{x:Math.floor((t.x-A.positionX)/(A.gap+this._columnWidth)),y:Math.floor((t.y-A.positionY)/(A.gap+this._rowHeight))}}getPositionByCoords(t){return{x:A.positionX+t.x*(A.gap+this._columnWidth),y:A.positionY+t.y*(A.gap+this._rowHeight)}}_getCellByCoords(t){return this._map[t.y][t.x]}_isFieldIncludesPosition(t){return t.x>A.positionX&&t.x<A.positionX+A.width&&t.y>A.positionY&&t.y<A.positionY+A.height}_setMetrics(){const{x:t,y:i}=this._level.getMapLengths();this._columnWidth=(A.width-A.gap*(t-1))/t,this._rowHeight=(A.height-A.gap*(i-1))/i,this._maxOutOfBoundsX=(A.gap+this._columnWidth)/2,this._maxOutOfBoundsY=(A.gap+this._rowHeight)/2}_setMap(){const{x:t,y:i}=this._level.getMapLengths();for(let e=0;e<i;e++){const i=[];for(let s=0;s<t;s++){const t=new T({coords:{x:s,y:e}});i.push(t)}this._map.push(i)}}_setTiles(){const t=this._level.getColors();this._map.forEach((i=>{i.forEach((i=>{const e=i.getCoords(),s=t.shift(),n=this._createTile(e,s);i.setTile(n)}))}))}_createTile(t,i){const e=this.getPositionByCoords(t),s={width:this._columnWidth,height:this._rowHeight};return new B({ctx:this._ctx,color:i,size:s,position:e})}static width=662;static height=662;static positionX=19;static positionY=292;static gap=10}class z{constructor({canvas:t,ctx:i,assets:e,state:s,levels:n,sceneManager:o,level:a}){this._canvas=t,this._ctx=i,this._assets=e,this._state=s,this._levels=n,this._sceneManager=o,this._backButton=null,this._initButton(),this._level=a,this._levelPreview=new C({ctx:this._ctx,map:this._level.getTargetMap()}),this._field=new A({ctx:this._ctx,assets:this._assets,state:this._state,levels:this._levels,sceneManager:this._sceneManager,level:this._level})}update(t){this._field.update(t)}render(){m.rect(this._ctx,0,0,this._canvas.width,this._canvas.height,x.blueDeep.key),this._backButton.render(),this._levelPreview.render(),this._field.render()}handleClick({position:t}){this._backButton.isPressed(t)&&this._sceneManager.showLevelsScene(this._level.getKey())}handleStartDragging(t){this._field.handleStartDragging(t)}handleDragging(t){this._field.handleDragging(t)}handleEndDragging(t){this._field.handleEndDragging(t)}_initButton(){this._backButton=new f({ctx:this._ctx,position:{x:z.backButtonPositionX,y:z.backButtonPositionY},size:{width:z.backButtonWidth,height:f.height},label:z.backButtonLabel})}static backButtonLabel="Назад";static backButtonWidth=181;static backButtonPositionX=19;static backButtonPositionY=19}class Y{constructor({canvas:t,ctx:i,assets:e,state:s,levels:n,sceneManager:o,moves:a,score:h,level:r}){this._canvas=t,this._ctx=i,this._assets=e,this._state=s,this._levels=n,this._sceneManager=o,this._moves=a,this._score=h,this._level=r,this._ratingPreview=new M({ctx:this._ctx,state:this._state,assets:this._assets}),this._titleMarkup=[],this._setTitleMarkup(),this._movesHintPosition={x:0,y:0},this._setMovesHintPosition(),this._movesPosition={x:0,y:0},this._setMovesPosition(),this._scoreMarkup=[],this._setLevelScoreMarkup(),this._continueButton=null,this._repeatButton=null,this._initButtons()}update(t){}render(){m.rect(this._ctx,0,0,this._canvas.width,this._canvas.height,x.blueDeep.key),this._ratingPreview.render(),this._titleMarkup.forEach((({string:t,position:i})=>{m.text(this._ctx,i.x,i.y,t,Y.titleFontSize,x.white.key)})),m.text(this._ctx,this._movesHintPosition.x,this._movesHintPosition.y,Y.movesHintLabel,Y.movesHintFontSize,x.yellow.key),m.text(this._ctx,this._movesPosition.x,this._movesPosition.y,this._moves,Y.movesFontSize,x.yellow.key),this._scoreMarkup.forEach((({icon:t,position:i})=>{m.image(this._ctx,i.x,i.y,Y.iconWidth,Y.iconHeight,t)})),this._continueButton.render(),this._repeatButton.render()}_showNextLevelOrLevelsMenu(){const t=this._level.getKey(),i=this._level.getIndex()+1,e=this._levels.getLevelByKeyAndIndex(t,i);if(e){const{id:s,targetMap:n,initialMap:o,moves:a}=e;this._sceneManager.showCoreScene(new k({key:t,index:i,id:s,targetMap:n,initialMap:o,moves:a}))}else this._sceneManager.showLevelsScene(t)}handleClick({position:t}){this._continueButton.isPressed(t)?this._showNextLevelOrLevelsMenu():this._repeatButton.isPressed(t)&&this._sceneManager.showCoreScene(this._level)}handleStartDragging(){}handleDragging(){}handleEndDragging(){}_setMovesHintPosition(){this._movesHintPosition.x=Y.movesHintPositionX,this._movesHintPosition.y=Y.movesHintPositionY+Y.movesHintFontSize}_setMovesPosition(){const{textWidth:t}=y.calcTextMetrics(this._ctx,this._moves,Y.movesFontSize);this._movesPosition.x=this._canvas.width/2-t/2,this._movesPosition.y=Y.movesPositionY+Y.movesFontSize}_setTitleMarkup(){const t=[Y.title.split("<br>")],i=y.calcMultistringTextMetrics(this._ctx,t,Y.titleFontSize,Y.titleLineHeight);this._titleMarkup=i.map((t=>{const{string:i,positionY:e,width:s}=t;return{string:i,position:{x:this._canvas.width/2-s/2,y:Y.titlePositionY+e}}}))}_setLevelScoreMarkup(){const t=[];for(let i=0;i<u.maxScore;i++)t.push({icon:i<this._score?this._assets.get("star-yellow.png"):this._assets.get("star-blue.png"),position:{x:Y.ratingPositionX+i*(Y.iconWidth+Y.iconGap),y:Y.ratingPositionY}});this._scoreMarkup=t}_initButtons(){this._continueButton=new f({ctx:this._ctx,position:{x:Y.continueButtonPositionX,y:Y.continueButtonPositionY},size:{width:Y.continueButtonWidth,height:Y.buttonsHeight},label:Y.continueButtonLabel}),this._repeatButton=new f({ctx:this._ctx,position:{x:Y.repeatButtonPositionX,y:Y.repeatButtonPositionY},size:{width:Y.repeatButtonWidth,height:Y.buttonsHeight},label:Y.repeatButtonLabel})}static title="Уровень<br>пройден!";static titleFontSize=72;static titleLineHeight=76;static titlePositionY=251;static movesHintLabel="Ходов:";static movesHintFontSize=48;static movesHintPositionX=267;static movesHintPositionY=483;static movesFontSize=96;static movesPositionY=541;static ratingPositionX=221;static ratingPositionY=667;static iconWidth=73;static iconHeight=70;static iconGap=20;static continueButtonLabel="Продолжить";static continueButtonPositionX=206;static continueButtonPositionY=817;static continueButtonWidth=289;static repeatButtonLabel="Повторить уровень";static repeatButtonPositionX=151;static repeatButtonPositionY=921;static repeatButtonWidth=399;static buttonsHeight=74}class O{constructor({canvas:t,ctx:i,assets:e,state:s,levels:n}){this._canvas=t,this._ctx=i,this._assets=e,this._state=s,this._levels=n,this._currentScene=null,this._futureScene=null,this._transitionOverlayOffsetX=1}update(t){this._currentScene&&this._currentScene.update(t),this._futureScene?this._updateSceneOut(t):this._transitionOverlayOffsetX<=0&&this._updateSceneIn(t)}_updateSceneOut({prevFrameDuration:t}){this._currentScene&&0!==this._transitionOverlayOffsetX?this._transitionOverlayOffsetX=Math.max(this._transitionOverlayOffsetX-t/O.transitionDuration,0):(this._currentScene=this._futureScene,this._futureScene=null)}_updateSceneIn({prevFrameDuration:t}){this._transitionOverlayOffsetX=Math.max(this._transitionOverlayOffsetX-t/O.transitionDuration,-1),-1===this._transitionOverlayOffsetX&&(this._transitionOverlayOffsetX=1)}render(){this._currentScene&&this._currentScene.render(),1!==this._transitionOverlayOffsetX&&this._renderTransitionOverlay()}_renderTransitionOverlay(){const t=this._canvas.width*this._transitionOverlayOffsetX;m.rect(this._ctx,t,0,this._canvas.width,this._canvas.height,x.blueDeep.key)}_getScenesCommonProps(){return{canvas:this._canvas,ctx:this._ctx,assets:this._assets,state:this._state,levels:this._levels,sceneManager:this}}_isInTransition(){return this._futureScene||1!==this._transitionOverlayOffsetX}handleClick(t){this._isInTransition()||this._currentScene&&this._currentScene.handleClick(t)}handleStartDragging(t){this._isInTransition()||this._currentScene&&this._currentScene.handleStartDragging(t)}handleDragging(t){this._isInTransition()||this._currentScene&&this._currentScene.handleDragging(t)}handleEndDragging(t){this._isInTransition()||this._currentScene&&this._currentScene.handleEndDragging(t)}showOpenScene(){this._futureScene=new b(this._getScenesCommonProps())}showAboutScene(){this._futureScene=new w(this._getScenesCommonProps())}showLevelsScene(t){this._futureScene=new L({...this._getScenesCommonProps(),levelsKey:t})}showCoreScene(t){this._futureScene=new z({...this._getScenesCommonProps(),level:t})}showResultScene(t,i,e){this._futureScene=new Y({...this._getScenesCommonProps(),moves:t,score:i,level:e})}static transitionDuration=300}const F=JSON.parse('{"beginner":[{"id":1,"targetMap":[[3,3,3,3],[3,10,10,3],[3,10,10,3],[3,3,3,3]],"initialMap":[[3,3,10,3],[10,3,10,3],[3,10,3,3],[3,3,3,3]],"moves":4},{"id":2,"targetMap":[[5,3,3,5],[3,5,5,3],[3,5,5,3],[5,3,3,5]],"initialMap":[[5,3,3,5],[5,3,5,3],[3,5,5,5],[3,3,3,5]],"moves":4},{"id":3,"targetMap":[[3,4,4,3],[4,4,4,6],[4,6,6,6],[3,6,6,3]],"initialMap":[[3,4,3,3],[6,4,6,6],[6,6,4,6],[4,4,4,3]],"moves":8},{"id":4,"targetMap":[[3,7,3,7,3],[7,9,9,9,7],[7,9,10,9,7],[3,7,9,7,3],[3,3,7,3,3]],"initialMap":[[9,10,3,9,7],[3,9,9,3,7],[9,7,9,7,7],[7,7,7,7,3],[3,3,3,3,3]],"moves":16},{"id":5,"targetMap":[[3,3,5,3],[3,9,5,5],[9,9,10,3],[9,9,3,3]],"initialMap":[[5,5,5,9],[9,3,9,9],[9,10,3,3],[3,3,3,3]],"moves":12},{"id":6,"targetMap":[[7,7,7,3],[7,10,7,3],[7,7,7,5],[3,5,5,3]],"initialMap":[[10,5,3,5],[7,3,3,3],[5,7,7,7],[7,7,7,7]],"moves":12},{"id":7,"targetMap":[[3,5,9,3],[5,9,9,10],[9,9,9,10],[3,9,10,3]],"initialMap":[[5,9,9,5],[9,3,3,9],[9,9,3,10],[9,10,10,3]],"moves":12},{"id":8,"targetMap":[[4,3,4,3,4],[3,4,6,4,3],[4,6,6,6,4],[3,4,6,4,3],[4,3,4,3,4]],"initialMap":[[4,3,3,4,4],[4,3,6,3,3],[4,3,6,3,6],[4,4,3,4,6],[4,6,4,4,4]],"moves":16},{"id":9,"targetMap":[[3,7,4,3],[7,7,4,4],[10,10,5,5],[3,10,5,3]],"initialMap":[[4,10,4,7],[4,3,10,3],[10,3,7,5],[5,5,3,7]],"moves":20},{"id":10,"targetMap":[[10,10,10,5],[4,3,3,5],[4,3,3,5],[4,7,7,7]],"initialMap":[[5,3,5,3],[7,4,3,3],[10,4,5,4],[10,10,7,7]],"moves":16},{"id":11,"targetMap":[[10,10,10,7],[5,10,7,7],[5,5,4,7],[5,4,4,4]],"initialMap":[[5,7,7,7],[5,10,10,7],[4,10,4,10],[5,4,5,4]],"moves":16},{"id":12,"targetMap":[[10,10,10,7,7],[10,10,10,7,7],[5,5,3,7,7],[5,5,4,4,4],[5,5,4,4,4]],"initialMap":[[3,4,7,5,4],[4,10,5,7,5],[10,5,7,4,10],[7,4,7,7,5],[4,5,10,10,10]],"moves":24}],"medium":[{"id":13,"targetMap":[[3,3,5,5,3,3],[3,3,8,5,5,3],[3,8,8,5,8,3],[3,8,8,8,8,3],[3,3,8,8,3,3],[3,3,3,8,3,3]],"initialMap":[[8,8,5,5,8,5],[8,5,5,3,8,8],[3,3,8,8,8,3],[3,8,3,3,3,8],[3,3,3,3,3,3],[3,3,3,3,3,3]],"moves":20},{"id":14,"targetMap":[[3,4,3,4,3,4],[4,6,4,6,4,6],[6,3,6,3,6,3],[3,4,3,4,3,4],[4,6,4,6,4,6],[6,3,6,3,6,3]],"initialMap":[[4,6,4,4,4,6],[4,3,4,4,3,4],[3,3,3,4,4,3],[3,6,3,4,6,3],[4,6,3,6,6,6],[6,6,6,6,3,3]],"moves":40},{"id":15,"targetMap":[[6,6,6,6,6,3],[6,4,4,4,4,4],[6,4,3,3,6,4],[6,4,3,3,6,4],[6,6,6,6,6,4],[3,4,4,4,4,4]],"initialMap":[[3,6,6,3,6,3],[3,4,3,6,3,6],[6,6,4,4,4,4],[4,6,4,4,4,4],[4,6,6,6,6,4],[4,4,6,4,6,6]],"moves":30},{"id":16,"targetMap":[[3,3,4,4,4,3,3],[3,4,4,4,4,4,3],[4,6,6,6,6,4,6],[6,6,6,3,6,6,6],[6,4,6,3,3,3,3],[6,4,4,6,4,3,3],[4,6,4,4,6,6,6]],"initialMap":[[4,4,3,4,6,4,6],[6,4,4,4,4,3,3],[4,6,6,3,4,4,4],[3,6,6,4,4,3,3],[4,6,4,3,3,3,3],[4,6,6,6,6,3,6],[6,3,6,6,6,6,6]],"moves":50},{"id":17,"targetMap":[[4,4,4,7,9,10],[4,4,4,7,9,9],[6,4,4,4,7,7],[6,6,4,4,4,4],[6,6,6,4,4,6],[4,4,4,4,6,6]],"initialMap":[[6,4,7,10,7,6],[6,6,9,4,6,6],[4,7,4,7,9,9],[4,4,4,6,6,4],[6,4,4,4,4,4],[4,4,4,4,4,4]],"moves":24},{"id":18,"targetMap":[[6,4,4,4,4,4],[6,4,6,6,6,6],[6,4,6,4,4,6],[6,4,6,6,4,6],[6,4,4,4,4,6],[6,6,6,6,6,6]],"initialMap":[[4,4,6,6,4,6],[6,4,4,4,4,6],[4,4,4,6,6,4],[6,6,4,4,4,6],[4,6,6,6,6,6],[6,6,6,6,6,6]],"moves":30},{"id":19,"targetMap":[[10,10,10,10,10,7],[5,10,10,10,7,7],[5,5,10,7,7,7],[5,5,5,4,7,7],[5,5,4,4,4,7],[5,4,4,4,4,4]],"initialMap":[[7,10,5,5,7,5],[7,7,4,5,5,7],[5,10,10,7,5,4],[5,10,5,7,10,7],[7,10,10,4,10,4],[10,4,4,4,4,4]],"moves":50},{"id":20,"targetMap":[[9,10,9,3,9,9,9],[10,3,9,3,9,3,10],[9,9,9,10,9,10,10],[3,3,10,3,9,3,3],[9,9,9,9,9,10,9],[9,3,10,3,10,3,9],[9,10,10,3,9,9,9]],"initialMap":[[9,3,10,9,10,10,10],[10,10,9,9,9,10,10],[10,10,10,3,10,9,3],[3,3,9,3,9,9,3],[9,9,3,3,9,9,9],[9,3,9,3,9,9,3],[9,3,9,9,9,9,9]],"moves":50},{"id":21,"targetMap":[[3,3,3,5,3,3,3],[3,3,5,5,10,3,3],[3,10,5,5,10,10,3],[3,10,5,10,10,10,3],[3,10,10,10,10,10,3],[3,3,10,10,10,3,3],[3,3,3,10,3,3,3]],"initialMap":[[5,5,5,10,10,5,5],[10,10,3,5,3,10,10],[3,3,3,10,3,10,3],[10,10,10,3,3,3,3],[10,10,3,3,3,10,3],[3,10,10,10,3,3,3],[3,3,3,3,3,3,3]],"moves":36},{"id":22,"targetMap":[[3,7,7,3,7,7,3],[7,9,9,9,9,9,7],[7,9,10,10,10,9,7],[7,9,10,10,10,9,7],[3,7,9,10,9,7,3],[3,3,7,9,7,3,3],[3,3,3,7,3,3,3]],"initialMap":[[10,3,9,3,9,3,10],[9,9,3,9,7,7,7],[7,9,9,7,7,9,9],[9,7,7,7,7,7,9],[3,3,9,7,3,3,7],[7,10,10,3,7,10,10],[10,3,3,3,3,3,3]],"moves":40},{"id":23,"targetMap":[[3,3,3,9,3,3,3],[3,3,10,9,9,3,3],[3,5,7,5,9,9,3],[3,10,10,10,7,9,9],[5,10,5,10,10,10,3],[10,7,10,3,3,3,3],[10,3,3,3,3,3,3]],"initialMap":[[9,3,7,5,7,3,7],[9,9,9,10,3,9,10],[3,10,9,3,10,3,5],[9,10,10,3,5,10,10],[10,5,10,10,3,3,3],[3,3,3,3,3,3,3],[3,3,3,3,3,3,3]],"moves":50},{"id":24,"targetMap":[[10,10,10,10,10,10,5],[10,3,3,3,3,5,5],[5,3,3,3,5,5,5],[5,5,3,5,5,5,10],[5,5,5,5,5,3,10],[10,5,5,5,3,3,10],[10,10,5,10,10,10,10]],"initialMap":[[5,5,10,10,5,5,5],[3,5,10,5,5,5,10],[5,3,10,5,3,5,5],[10,5,5,5,5,5,10],[5,10,5,5,3,3,3],[10,3,10,10,10,10,10],[10,3,3,3,3,10,10]],"moves":50}],"hard":[{"id":25,"targetMap":[[3,3,3,7,3,3,10],[10,3,7,7,3,3,3],[3,3,7,9,7,3,3],[3,7,9,10,9,7,3],[7,9,10,10,9,7,3],[7,7,10,10,10,9,3],[7,9,10,10,10,9,7]],"initialMap":[[3,3,7,7,10,10,3],[9,7,3,10,9,7,9],[9,7,7,7,3,10,3],[9,10,3,3,10,9,10],[3,3,3,7,3,3,3],[3,7,10,3,7,9,10],[7,9,10,7,10,7,3]],"moves":50},{"id":26,"targetMap":[[3,3,10,10,10,3,3],[3,10,3,10,3,10,3],[10,10,3,10,3,10,10],[10,10,10,10,10,10,10],[10,10,10,3,10,10,10],[3,10,10,3,10,10,3],[3,3,10,10,10,3,3]],"initialMap":[[10,3,10,3,10,10,10],[3,10,10,10,10,10,10],[10,3,3,3,10,3,10],[10,10,10,10,10,3,3],[3,3,10,10,10,10,10],[10,10,3,3,10,10,3],[3,3,3,10,10,10,3]],"moves":30},{"id":27,"targetMap":[[3,3,3,3,3,3,3],[3,6,6,4,6,4,3],[6,6,4,6,4,6,4],[3,6,6,4,6,4,3],[3,3,6,6,4,3,3],[3,3,3,6,3,3,3],[3,3,3,3,3,3,3]],"initialMap":[[3,3,3,3,6,3,3],[4,6,6,3,3,6,4],[4,3,6,3,6,4,3],[3,6,3,4,3,3,3],[3,3,3,3,6,6,3],[4,6,3,6,6,3,6],[3,3,4,3,4,3,3]],"moves":30},{"id":28,"targetMap":[[3,7,7,10,10,3],[3,7,7,10,10,3],[3,7,9,9,10,3],[3,10,9,9,7,3],[3,10,10,7,7,3],[3,3,10,7,3,3]],"initialMap":[[7,10,10,3,10,7],[10,7,3,3,9,10],[3,7,3,9,3,7],[3,3,10,7,9,10],[10,7,9,3,3,3],[3,10,7,3,3,7]],"moves":42},{"id":29,"targetMap":[[5,5,5,5,4,5,5],[5,5,5,5,4,4,5],[5,4,9,4,4,4,9],[9,5,5,5,10,10,5],[5,5,5,5,5,10,10],[5,5,5,5,10,10,10],[5,10,10,10,10,10,5]],"initialMap":[[5,5,5,5,5,5,5],[5,4,5,5,10,10,5],[5,5,5,4,5,9,5],[10,10,10,4,9,10,5],[5,5,5,10,5,5,10],[10,10,5,4,5,10,4],[4,9,4,10,5,5,5]],"moves":42},{"id":30,"targetMap":[[4,4,6,6,9,9,10],[4,6,6,9,9,10,10],[4,6,9,9,10,10,9],[6,6,9,9,10,10,5],[9,9,9,10,10,9,5],[9,10,10,10,10,5,5],[10,9,10,5,5,5,5]],"initialMap":[[10,5,9,6,6,10,9],[5,4,9,9,9,10,9],[5,9,10,10,10,6,5],[5,10,4,5,9,5,10],[6,10,10,10,4,6,9],[10,6,9,10,5,10,9],[6,9,9,10,9,4,9]],"moves":50},{"id":31,"targetMap":[[3,5,5,3,3,3,3],[5,9,3,3,5,5,3],[5,3,9,3,3,9,5],[3,3,9,3,9,3,5],[4,5,10,10,10,5,4],[5,10,10,10,10,10,5],[4,4,4,4,4,4,4]],"initialMap":[[5,9,5,3,9,3,5],[4,10,9,3,10,3,5],[3,4,5,9,5,10,3],[4,4,3,3,10,4,10],[5,10,4,4,3,3,4],[10,3,3,3,5,5,5],[10,9,5,4,3,3,5]],"moves":80},{"id":32,"targetMap":[[5,5,5,5,5,7],[10,10,10,10,5,7],[10,4,3,3,5,7],[10,4,3,3,5,7],[10,4,7,7,7,7],[10,4,4,4,4,4]],"initialMap":[[3,7,10,7,7,5],[4,7,5,4,7,5],[5,7,4,5,10,5],[4,4,3,4,3,7],[4,10,7,10,5,3],[10,5,10,10,10,4]],"moves":80},{"id":33,"targetMap":[[10,5,5,5,5,5,5],[10,5,10,10,10,10,5],[10,5,10,5,5,10,5],[10,5,10,10,5,10,5],[10,5,5,5,5,10,5],[10,10,10,10,10,10,5],[5,5,5,5,5,5,5]],"initialMap":[[10,5,10,10,5,5,5],[5,10,5,10,10,5,10],[10,5,5,10,10,10,10],[5,5,10,5,10,5,10],[5,5,5,5,5,10,5],[5,5,10,5,10,5,5],[5,10,5,10,10,5,5]],"moves":30},{"id":34,"targetMap":[[7,7,7,7,7,3,3],[7,9,9,9,9,9,3],[7,9,10,10,10,10,10],[7,9,10,3,7,9,10],[7,7,7,7,7,9,10],[3,9,9,9,9,9,10],[3,3,10,10,10,10,10]],"initialMap":[[9,7,7,3,9,10,9],[7,9,7,3,10,10,7],[10,10,9,7,3,10,9],[3,10,9,7,10,7,10],[9,10,9,3,7,10,7],[9,3,9,10,10,7,9],[7,7,7,9,3,10,9]],"moves":60},{"id":35,"targetMap":[[3,3,3,3,7,7,7],[8,8,8,3,7,10,7],[8,10,9,9,9,7,7],[8,8,9,10,9,5,3],[5,7,7,7,9,3,3],[3,7,10,7,5,3,3],[3,7,7,7,3,3,3]],"initialMap":[[9,3,7,3,3,8,3],[3,3,7,5,5,8,3],[3,7,3,7,7,7,7],[3,10,5,10,10,3,7],[3,3,7,7,8,7,9],[8,7,9,7,3,8,9],[9,9,3,8,7,7,10]],"moves":60},{"id":36,"targetMap":[[3,7,9,9,7,3],[7,9,10,10,9,7],[9,10,5,5,10,9],[10,5,6,6,5,10],[5,6,4,4,6,5],[6,4,8,8,4,6]],"initialMap":[[5,9,4,4,6,7],[10,3,7,7,6,10],[9,5,9,4,10,10],[7,5,9,6,5,4],[6,3,9,8,10,9],[6,8,10,5,6,5]],"moves":60}]}');class E{constructor(t){this._canvas=t,this._ctx=t.getContext("2d"),this._setRenderSize(),this._assets=new d,this._levels=new u({levels:F}),this._state=new v({levels:this._levels}),this._sceneManager=new O({canvas:this._canvas,ctx:this._ctx,assets:this._assets,levels:this._levels,state:this._state}),this._prevTimestamp=null,this._draggingStarted=!1,this._addEventHandlers(),this._startGame()}async _startGame(){await document.fonts.load("1px Nunito"),await this._assets.load(),this._sceneManager.showOpenScene(),requestAnimationFrame((t=>{this._gameLoop(t)}))}_gameLoop(t){requestAnimationFrame((t=>{this._gameLoop(t)}));const i=t-(this._prevTimestamp||t),e=i/1e3;this._sceneManager.update({delta:e,prevFrameDuration:i,timestamp:t}),this._prevTimestamp=t,this._render()}_render(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._sceneManager.render()}_addEventHandlers(){this._canvas.addEventListener("click",(t=>this._handleClick(t))),this._canvas.addEventListener("mousedown",(t=>this._handleStartDragging(t))),window.addEventListener("mousemove",(t=>this._handleDragging(t))),window.addEventListener("mouseup",(t=>this._handleEndDragging(t))),this._canvas.addEventListener("touchstart",(t=>this._handleStartDragging(t))),window.addEventListener("touchmove",(t=>this._handleDragging(t))),window.addEventListener("touchend",(t=>this._handleEndDragging(t))),window.addEventListener("resize",(()=>this._setRenderSize()))}_handleClick(t){const{clientX:i,clientY:e}=t,s=this._transformClickPosition({x:i,y:e});this._sceneManager.handleClick({position:s})}_handleStartDragging(t){this._draggingStarted=!0;const{clientX:i,clientY:e}=t.touches?.[0]||t,s=this._transformClickPosition({x:i,y:e});this._sceneManager.handleStartDragging({position:s})}_handleEndDragging(t){this._draggingStarted=!1;const{clientX:i,clientY:e}=t.touches?.[0]||t,s=this._transformClickPosition({x:i,y:e});this._sceneManager.handleEndDragging({position:s})}_handleDragging(t){if(!this._draggingStarted)return;const{clientX:i,clientY:e}=t.touches?.[0]||t,s=this._transformClickPosition({x:i,y:e});this._sceneManager.handleDragging({position:s})}_transformClickPosition({x:t,y:i}){return t-=this._canvas.getBoundingClientRect().left,t*=this._canvas.width/parseFloat(this._canvas.style.width),i-=this._canvas.getBoundingClientRect().top,{x:t,y:i*=this._canvas.height/parseFloat(this._canvas.style.height)}}_setRenderSize(){const t=document.documentElement.clientWidth,i=document.documentElement.clientHeight;let e=this._canvas.width/this._canvas.height,s=i,n=s*e;n>t&&(e=this._canvas.height/this._canvas.width,n=t,s=n*e),this._canvas.style.width=n+"px",this._canvas.style.height=s+"px"}}addEventListener("DOMContentLoaded",(async()=>{new E(document.getElementById("colored-tiles"))}))})()})();
//# sourceMappingURL=index.js.map